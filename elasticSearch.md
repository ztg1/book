# ElasticSearch学习笔记



## 集群内的原理

### 集群健康

命令：`GET /_cluster/health`



`status` 字段指示着当前集群在总体上是否工作正常。它的三种颜色含义如下：

- **`green`**

  所有的主分片和副本分片都正常运行。

- **`yellow`**

  所有的主分片都正常运行，但不是所有的副本分片都正常运行。

- **`red`**

  有主分片没能正常运行。



#### 分片

​    **分片**：主分片和副分片

​     一个分片是一个工作单元，一个分片就是一个Lucene实例，而Lucene本身就是一个完整的搜索引擎。文档是直接存储在分片内的。

​    主分片决定着存储数据量的大小；副分片是主分片的一个拷贝，作为硬件故障时的保护数据不丢失的冗余备份备份，并且为搜文档提供服务器。

每一个节点都保存着完整的数据，也许是主分片也许是副分片，当有节点挂掉时，系统重新布置分片。当主节点挂掉时，新的节点立刻成为主节点，并且从布置分片。





### 数据存储

​    文档存储在分片中，在存储前是有个规则的，存储在按个分片是有规则的

公式：

```json
shard = hash(routing) % number_of_primary_shards

routing 是一个可变值，默认是文档的 _id ，也可以设置成一个自定义的值。 routing 通过 hash 函数生成一个数字，然后这个数字再除以 number_of_primary_shards （主分片的数量）后得到 余数 。这个分布在 0 到 number_of_primary_shards-1 之间的余数，就是我们所寻求的文档所在分片的位置。
```

 









1、分布式检索













